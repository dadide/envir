FROM ubuntu:20.04

RUN echo "deb http://mirrors.163.com/ubuntu/ xenial main restricted universe multiverse \
deb http://mirrors.163.com/ubuntu/ xenial-security main restricted universe multiverse \
deb http://mirrors.163.com/ubuntu/ xenial-updates main restricted universe multiverse \
deb http://mirrors.163.com/ubuntu/ xenial-proposed main restricted universe multiverse \
deb http://mirrors.163.com/ubuntu/ xenial-backports main restricted universe multiverse \
deb-src http://mirrors.163.com/ubuntu/ xenial main restricted universe multiverse \
deb-src http://mirrors.163.com/ubuntu/ xenial-security main restricted universe multiverse \
deb-src http://mirrors.163.com/ubuntu/ xenial-updates main restricted universe multiverse \
deb-src http://mirrors.163.com/ubuntu/ xenial-proposed main restricted universe multiverse \
deb-src http://mirrors.163.com/ubuntu/ xenial-backports main restricted universe multiverse" > /etc/apt/sources.list


RUN echo "deb http://mirrors.aliyun.com/ubuntu/ xenial main \
deb-src http://mirrors.aliyun.com/ubuntu/ xenial main \
deb http://mirrors.aliyun.com/ubuntu/ xenial-updates main \
deb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates main \
deb http://mirrors.aliyun.com/ubuntu/ xenial universe \
deb-src http://mirrors.aliyun.com/ubuntu/ xenial universe \
deb http://mirrors.aliyun.com/ubuntu/ xenial-updates universe \
deb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates universe \
deb http://mirrors.aliyun.com/ubuntu/ xenial-security main \
deb-src http://mirrors.aliyun.com/ubuntu/ xenial-security main \
deb http://mirrors.aliyun.com/ubuntu/ xenial-security universe \
deb-src http://mirrors.aliyun.com/ubuntu/ xenial-security universe" > /etc/apt/sources.list

# aliyun + miniPCI can + only one channel
# 0829
RUN apt-get update -y
RUN apt-get install -y python3-pip 
RUN pip3 install --upgrade pip

RUN apt-get install -y python3-dev
RUN pip3 install oss2
RUN pip3 install serial
RUN pip3 install pyserial
RUN pip3 install -i https://pypi.tuna.tsinghua.edu.cn/simple numpy 
RUN pip3 install -i https://pypi.tuna.tsinghua.edu.cn/simple matplotlib
RUN pip3 install -i https://pypi.tuna.tsinghua.edu.cn/simple scipy
RUN pip3 install -i https://pypi.tuna.tsinghua.edu.cn/simple numba
RUN pip3 install -i https://pypi.tuna.tsinghua.edu.cn/simple cantools

RUN apt-get install -y libusb-1.0-0

ENV DEBIAN_FRONTEND=noninteractive
RUN apt-get -y install tzdata
RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
RUN dpkg-reconfigure -f noninteractive tzdata

ADD IVHM.tar.gz ./IVHM

WORKDIR /IVHM
RUN chmod +x runpyfinal.sh
ENTRYPOINT ["/IVHM/runpyfinal.sh"]


